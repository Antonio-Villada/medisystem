<div class="container">
    <h2>Gestión de Medicamentos</h2>

    <div *ngIf="successMessage" class="alert success">{{ successMessage }}</div>
    <div *ngIf="errorMessage" class="alert error">{{ errorMessage }}</div>

    <form (ngSubmit)="saveMedicamento()" class="medicamento-form">
        <h3>{{ isEditing ? 'Editar' : 'Crear Nuevo' }} Medicamento</h3>
        
        <div class="form-group">
            <input 
                type="text" 
                [(ngModel)]="medicamentoForm.nombreMedicamento" 
                name="nombreMedicamento" 
                placeholder="Nombre del Medicamento" 
                required>
        </div>

        <div class="form-group">
            <input 
                type="number" 
                [(ngModel)]="medicamentoForm.precio" 
                name="precio" 
                placeholder="Precio" 
                min="0.01"
                step="0.01"
                required
                #precioInput="ngModel" 
                [class.is-invalid]="precioInput.invalid && (precioInput.dirty || precioInput.touched)">
                
            <div *ngIf="precioInput.invalid && (precioInput.dirty || precioInput.touched)" class="validation-message">
                
                <div *ngIf="precioInput.errors?.['required']">El precio es obligatorio.</div>
                
                <div *ngIf="precioInput.errors?.['min']">El precio debe ser un valor numérico positivo (mínimo 0.01).</div>
                
                <div *ngIf="precioInput.invalid && !precioInput.errors?.['required']">
                    ⚠️ Ingrese solo números (mínimo 0.01).
                </div>
            </div>
        </div>
        
        <button type="submit" [disabled]="!medicamentoForm.nombreMedicamento.trim() || medicamentoForm.precio <= 0">
            {{ isEditing ? 'Guardar Cambios' : 'Crear Medicamento' }}
        </button>
        
        <button type="button" *ngIf="isEditing" (click)="resetForm()">
            Cancelar Edición
        </button>
    </form>

    <hr>
    
    <button (click)="loadMedicamentos()" [disabled]="loading">
        {{ loading ? 'Cargando...' : 'Recargar Lista' }}
    </button>
    
    <h3>Lista de Medicamentos</h3>

    <p *ngIf="loading">Cargando medicamentos...</p>

    <table *ngIf="!loading && medicamentoList.length > 0">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let medicamento of medicamentoList">
                <td>{{ medicamento.idMedicamento }}</td>
                <td>{{ medicamento.nombreMedicamento }}</td>
                <td>{{ medicamento.precio | currency:'USD' }}</td>
                <td>
                    <button (click)="editMedicamento(medicamento)">Editar</button>
                    <button (click)="deleteMedicamento(medicamento.idMedicamento)">Eliminar</button>
                </td>
            </tr>
        </tbody>
    </table>

    <p *ngIf="!loading && medicamentoList.length === 0">No se encontraron medicamentos.</p>
</div>